I"ü<p>I recently wanted to create a chart in excel that used colors that had opacity. Unfortunately, Excel only allows hex or RGB colors with no opacity for a cell fill. After some searching, I found the formula to convert an image with a defined opacity into a new color without.</p>

<h2 id="what-you-need-to-know-in-advance">What you need to know in advance</h2>
<ol>
  <li>The rgba values of the color to match</li>
  <li>The rgba values of the background
    <h2 id="the-formula">The formula</h2>
    <p>cr = cf x af + cb x ab x (1 - af)</p>
  </li>
</ol>

<p>Where:</p>
<ul>
  <li>cr = the resulting color</li>
  <li>cf = foreground color (The original color value)</li>
  <li>af = foreground alpha factor (0.00 through 1.00 - what you want to apply to the color)</li>
  <li>cb = background color (usually white, or 255)</li>
  <li>ab = background alpha factor (usually 1.0)</li>
  <li>Can sometimes be simplified to cr = cf + cb x (1 - af) - havenâ€™t worked the math on 	why.</li>
</ul>

<h2 id="explanation">Explanation</h2>
<p>Take the rgba value of your color to convert.
Example: <code class="language-plaintext highlighter-rouge">rgba(229,34,55,0.4)</code></p>

<ol>
  <li>Take the first value, 229, and run it through the formula
    <ul>
      <li>0 x 0.4 + 229 x 1.0 x (1 - 0.4) = 244.6 <em>can round to 245</em></li>
    </ul>
  </li>
  <li>Do this for each of the other values:
    <ul>
      <li>0 x 0.4 + 34 x 1.0 x (1 - 0.4) = 167</li>
      <li>0 x 0.4 + 55 x 1.0 x (1 - 0.4) = 175</li>
    </ul>
  </li>
  <li>Add these three to an rgb - <code class="language-plaintext highlighter-rouge">rgb(245,167,175)</code></li>
</ol>

<p>Examples:</p>

<table>
	<tr>
	<td style="height:120px; width:120px; background-color:rgba(229,34,55,0.4);text-align:center;border-right:2px solid #000;">Original, with opacity</td>
	<td style="height:120px; width:120px; background-color:rgb(122,44,53);text-align:center;">New, no opacity</td>
	</tr>
</table>

<ul>
  <li><em>note - values changed here due to the dark (non-white) background</em></li>
</ul>

<hr />

<h2 id="heres-a-calculator">Hereâ€™s a calculator!</h2>

<p><input class="input" id="cf" name="cf" /> Original foreground color <br />
<input class="input" id="af" name="af" /> Alpha factor to apply  <br />
<input class="input" id="cb" name="cb" /> Background color  <br />
<input class="input" id="ab" name="ab" /> background alpha (usually 1)  <br />
<input type="button" class="btn btn-dark" onclick="colorVal()" value="Run!" /></p>

<div id="colorValueAnswer">Value answer</div>

<p>Enter the rgba values for the color you want to match:<br />
<input class="input" id="rValMatch" /> <input class="input" id="gValMatch" /> <input class="input" id="bValMatch" /> <input class="input" id="oValMatch" />
Enter the rgba values for the background:<br />
<input class="input" id="rValBg" /> <input class="input" id="gValBg" /> <input class="input" id="bValBg" /> <input class="input" id="oValBg" /></p>

<p><input type="button" class="btn btn-dark" onclick="newColorVal()" value="Run the calculator" /></p>
:ET